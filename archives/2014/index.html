<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Archives: 2014 | WANE&#39;s LAIR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description">
<meta property="og:type" content="website">
<meta property="og:title" content="WANE's LAIR">
<meta property="og:url" content="http://yoursite.com/archives/2014/">
<meta property="og:site_name" content="WANE's LAIR">
<meta property="og:description">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="WANE's LAIR">
<meta name="twitter:description">

  
    <link rel="alternative" href="/atom.xml" title="WANE&#39;s LAIR" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">

  
</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">WANE&#39;s LAIR</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><input type="submit" value="&#xF002;" class="search-form-submit"><input type="hidden" name="q" value="site:http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Stop-Copy-and-Paste-in-your-code" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/10/07/Stop-Copy-and-Paste-in-your-code/" class="article-date">
  <time datetime="2014-10-07T06:42:54.000Z" itemprop="datePublished">Oct 7 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/10/07/Stop-Copy-and-Paste-in-your-code/">Stop Copy and Paste in your code</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>A program analyzer recently studied numbers of errors caused by the copy and paste method and made a conclusion that programmers most often tend to make mistakes in the last fragment of a homogeneous code block. He calls it Last Line Effect.</p>
<p>Sometimes the programers have to write a series of similar constructs. The programmers often deal this by copying a code fragment and paste it serval times for further editing, and this give birth to errors - it risks easily forgetting to change something in the pasted lines.</p>
<p>Here is a pattern discovered by the analyzer:</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">inline</span> Vector3int32& <span class="keyword">operator</span>+=(<span class="keyword">const</span> Vector3int32& other) {</div><div class="line">    x += other.x;</div><div class="line">    y += other.y;</div><div class="line">    z += other.y;</div><div class="line">    <span class="keyword">return</span> *<span class="keyword">this</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>Note the line ‘z += other.y;’. The programmer forgot to replace ‘y’ with ‘z’.</p>
<p>The analyzer also listed a few errors in famous production code.</p>
<h4 id="Source_Engine_SDK">Source Engine SDK</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">inline</span> <span class="keyword">void</span> Init( <span class="keyword">float</span> ix=<span class="number">0</span>, <span class="keyword">float</span> iy=<span class="number">0</span>, <span class="keyword">float</span> iz=<span class="number">0</span>, <span class="keyword">float</span> iw = <span class="number">0</span> ) </div><div class="line">{</div><div class="line">    SetX( ix );</div><div class="line">    SetY( iy );</div><div class="line">    SetZ( iz );</div><div class="line">    SetZ( iw );</div><div class="line">}</div></pre></td></tr></table></figure>

<p>The SetW() function should be called at the end.</p>
<h4 id="Chromium">Chromium</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (access & FILE_WRITE_ATTRIBUTES)</div><div class="line">    output.append(ASCIIToUTF16(<span class="string">"\tFILE_WRITE_ATTRIBUTES\n"</span>));</div><div class="line"><span class="keyword">if</span> (access & FILE_WRITE_DATA)</div><div class="line">    output.append(ASCIIToUTF16(<span class="string">"\tFILE_WRITE_DATA\n"</span>));</div><div class="line"><span class="keyword">if</span> (access & FILE_WRITE_EA)</div><div class="line">    output.append(ASCIIToUTF16(<span class="string">"\tFILE_WRITE_EA\n"</span>));</div><div class="line"><span class="keyword">if</span> (access & FILE_WRITE_EA)</div><div class="line">    output.append(ASCIIToUTF16(<span class="string">"\tFILE_WRITE_EA\n"</span>));</div><div class="line"><span class="keyword">break</span>;</div></pre></td></tr></table></figure>

<p>The last block and the one before it are identical.</p>
<h4 id="ReactOS">ReactOS</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (*ScanString == L<span class="string">'\"'</span> ||</div><div class="line">    *ScanString == L<span class="string">'^'</span> ||</div><div class="line">    *ScanString == L<span class="string">'\"'</span>)</div></pre></td></tr></table></figure>

<h4 id="Multi_Theft_Auto">Multi Theft Auto</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> CWaterPolySAInterface</div><div class="line">{</div><div class="line"><span class="keyword">public</span>:</div><div class="line">    WORD m_wVertexIDs[<span class="number">3</span>];</div><div class="line">};</div><div class="line"></div><div class="line">CWaterPoly* CWaterManagerSA::CreateQuad (....)</div><div class="line">{</div><div class="line">    ....</div><div class="line">    pInterface-&gt;m_wVertexIDs [ <span class="number">0</span> ] = pV1-&gt;GetID ();</div><div class="line">    pInterface-&gt;m_wVertexIDs [ <span class="number">1</span> ] = pV2-&gt;GetID ();</div><div class="line">    pInterface-&gt;m_wVertexIDs [ <span class="number">2</span> ] = pV3-&gt;GetID ();</div><div class="line">    pInterface-&gt;m_wVertexIDs [ <span class="number">3</span> ] = pV4-&gt;GetID ();</div><div class="line">    ....</div><div class="line">}</div></pre></td></tr></table></figure>

<p>The last line was pasted mechanically and is redundant. There are only 3 items in the array.</p>
<h4 id="Source_Engine_SDK-1">Source Engine SDK</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">intens.x=OrSIMD(AndSIMD(BackgroundColor.x,no_hit_mask),</div><div class="line">AndNotSIMD(no_hit_mask,intens.x));</div><div class="line">intens.y=OrSIMD(AndSIMD(BackgroundColor.y,no_hit_mask),</div><div class="line">AndNotSIMD(no_hit_mask,intens.y));</div><div class="line">intens.z=OrSIMD(AndSIMD(BackgroundColor.y,no_hit_mask),</div><div class="line">AndNotSIMD(no_hit_mask,intens.z));</div></pre></td></tr></table></figure>

<p>The programmer forgot to replace “BackgroundColor.y” with “BackgroundColor.z” in the last block.</p>
<h4 id="Trans-Proteomic_Pipeline">Trans-Proteomic Pipeline</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">void</span> setPepMaxProb(....)</div><div class="line">{  </div><div class="line">    ....</div><div class="line">    <span class="keyword">double</span> max4 = <span class="number">0.0</span>;</div><div class="line">    <span class="keyword">double</span> max5 = <span class="number">0.0</span>;</div><div class="line">    <span class="keyword">double</span> max6 = <span class="number">0.0</span>;</div><div class="line">    <span class="keyword">double</span> max7 = <span class="number">0.0</span>;</div><div class="line">    ....</div><div class="line">    <span class="keyword">if</span> ( pep3 ) { ... <span class="keyword">if</span> ( use_joint_probs && prob &gt; max3 ) ... }</div><div class="line">    ....</div><div class="line">    <span class="keyword">if</span> ( pep4 ) { ... <span class="keyword">if</span> ( use_joint_probs && prob &gt; max4 ) ... }</div><div class="line">    ....</div><div class="line">    <span class="keyword">if</span> ( pep5 ) { ... <span class="keyword">if</span> ( use_joint_probs && prob &gt; max5 ) ... }</div><div class="line">    ....</div><div class="line">    <span class="keyword">if</span> ( pep6 ) { ... <span class="keyword">if</span> ( use_joint_probs && prob &gt; max6 ) ... }</div><div class="line">    ....</div><div class="line">    <span class="keyword">if</span> ( pep7 ) { ... <span class="keyword">if</span> ( use_joint_probs && prob &gt; max6 ) ... }</div><div class="line">    ....</div><div class="line">}</div></pre></td></tr></table></figure>

<p>The programmer forgot to replace “prob &gt; max6” with “prob &gt; max7” in the last condition.</p>
<h4 id="SeqAn">SeqAn</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">inline</span> <span class="keyword">typename</span> Value&lt;Pipe&gt;::Type <span class="keyword">const</span> & <span class="keyword">operator</span>*() {</div><div class="line">    tmp.i1 = *in.in1;</div><div class="line">    tmp.i2 = *in.in2;</div><div class="line">    tmp.i3 = *in.in2;</div><div class="line">    <span class="keyword">return</span> tmp;</div><div class="line">}</div></pre></td></tr></table></figure>

<h4 id="SlimDX">SlimDX</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>( <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++ )</div><div class="line">{</div><div class="line">    sliders[i] = joystate.rglSlider[i];</div><div class="line">    asliders[i] = joystate.rglASlider[i];</div><div class="line">    vsliders[i] = joystate.rglVSlider[i];</div><div class="line">    fsliders[i] = joystate.rglVSlider[i];</div><div class="line">}</div></pre></td></tr></table></figure>

<p>The rglFSlider array should have been used in the last line.</p>
<h4 id="Qt">Qt</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (repetition == QStringLiteral(<span class="string">"repeat"</span>) ||</div><div class="line">    repetition.isEmpty()) {</div><div class="line">    pattern-&gt;patternRepeatX = <span class="keyword">true</span>;</div><div class="line">    pattern-&gt;patternRepeatY = <span class="keyword">true</span>;</div><div class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (repetition == QStringLiteral(<span class="string">"repeat-x"</span>)) {</div><div class="line">    pattern-&gt;patternRepeatX = <span class="keyword">true</span>;</div><div class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (repetition == QStringLiteral(<span class="string">"repeat-y"</span>)) {</div><div class="line">    pattern-&gt;patternRepeatY = <span class="keyword">true</span>;</div><div class="line">} <span class="keyword">else</span> <span class="keyword">if</span> (repetition == QStringLiteral(<span class="string">"no-repeat"</span>)) {</div><div class="line">    pattern-&gt;patternRepeatY = <span class="keyword">false</span>;</div><div class="line">    pattern-&gt;patternRepeatY = <span class="keyword">false</span>;</div><div class="line">} <span class="keyword">else</span> {</div><div class="line">    <span class="comment">//TODO: exception: SYNTAX_ERR</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>‘patternRepeatX’ is missing in the very last block. The correct code looks as follows:</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pattern-&gt;patternRepeatX = <span class="keyword">false</span>;</div><div class="line">pattern-&gt;patternRepeatY = <span class="keyword">false</span>;</div></pre></td></tr></table></figure>

<h4 id="ReactOS-1">ReactOS</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> istride = <span class="keyword">sizeof</span>(tmp[<span class="number">0</span>]) / <span class="keyword">sizeof</span>(tmp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]);</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> jstride = <span class="keyword">sizeof</span>(tmp[<span class="number">0</span>][<span class="number">0</span>]) / <span class="keyword">sizeof</span>(tmp[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]);</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> mistride = <span class="keyword">sizeof</span>(mag[<span class="number">0</span>]) / <span class="keyword">sizeof</span>(mag[<span class="number">0</span>][<span class="number">0</span>]);</div><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> mjstride = <span class="keyword">sizeof</span>(mag[<span class="number">0</span>][<span class="number">0</span>]) / <span class="keyword">sizeof</span>(mag[<span class="number">0</span>][<span class="number">0</span>]);</div></pre></td></tr></table></figure>

<p>The ‘mjstride’ variable will always be equal to one. The last line should have been written like this:</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> <span class="keyword">int</span> mjstride = <span class="keyword">sizeof</span>(mag[<span class="number">0</span>][<span class="number">0</span>]) / <span class="keyword">sizeof</span>(mag[<span class="number">0</span>][<span class="number">0</span>][<span class="number">0</span>]);</div></pre></td></tr></table></figure>

<h4 id="Mozilla_Firefox">Mozilla Firefox</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (protocol.EqualsIgnoreCase(<span class="string">"http"</span>) ||</div><div class="line">    protocol.EqualsIgnoreCase(<span class="string">"https"</span>) ||</div><div class="line">    protocol.EqualsIgnoreCase(<span class="string">"news"</span>) ||</div><div class="line">    protocol.EqualsIgnoreCase(<span class="string">"ftp"</span>) ||          &lt;&lt;&lt;---</div><div class="line">    protocol.EqualsIgnoreCase(<span class="string">"file"</span>) ||</div><div class="line">    protocol.EqualsIgnoreCase(<span class="string">"javascript"</span>) ||</div><div class="line">    protocol.EqualsIgnoreCase(<span class="string">"ftp"</span>)) {          &lt;&lt;&lt;---</div></pre></td></tr></table></figure>

<p>A suspicious string “ftp” at the end - it has already been compared to.</p>
<h4 id="Quake-III-Arena">Quake-III-Arena</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (<span class="built_in">fabs</span>(dir[<span class="number">0</span>]) &gt; test-&gt;radius ||</div><div class="line">    <span class="built_in">fabs</span>(dir[<span class="number">1</span>]) &gt; test-&gt;radius ||</div><div class="line">    <span class="built_in">fabs</span>(dir[<span class="number">1</span>]) &gt; test-&gt;radius)</div></pre></td></tr></table></figure>

<p>The value from the dir[2] cell is left unchecked.</p>
<h4 id="Clang">Clang</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">return</span> (ContainerBegLine &lt;= ContaineeBegLine &&</div><div class="line">        ContainerEndLine &gt;= ContaineeEndLine &&</div><div class="line">        (ContainerBegLine != ContaineeBegLine ||</div><div class="line">         SM.getExpansionColumnNumber(ContainerRBeg) &lt;=</div><div class="line">         SM.getExpansionColumnNumber(ContaineeRBeg)) &&</div><div class="line">        (ContainerEndLine != ContaineeEndLine ||</div><div class="line">         SM.getExpansionColumnNumber(ContainerREnd) &gt;=</div><div class="line">         SM.getExpansionColumnNumber(ContainerREnd)));</div></pre></td></tr></table></figure>

<p>At the very end of the block, the “SM.getExpansionColumnNumber(ContainerREnd)” expression is compared to itself.</p>
<h4 id="MongoDB">MongoDB</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">bool</span> <span class="keyword">operator</span>==(<span class="keyword">const</span> MemberCfg& r) <span class="keyword">const</span> {</div><div class="line">    ....</div><div class="line">    <span class="keyword">return</span> _id==r._id && votes == r.votes &&</div><div class="line">           h == r.h && priority == r.priority &&</div><div class="line">           arbiterOnly == r.arbiterOnly &&</div><div class="line">           slaveDelay == r.slaveDelay &&</div><div class="line">           hidden == r.hidden &&</div><div class="line">           buildIndexes == buildIndexes;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>The programmer forgot about “r.” in the last line.</p>
<h4 id="Unreal_Engine_4">Unreal Engine 4</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">static</span> <span class="keyword">bool</span> PositionIsInside(....)</div><div class="line">{</div><div class="line">    <span class="keyword">return</span></div><div class="line">        Position.X &gt;= Control.Center.X - BoxSize.X * <span class="number">0.5f</span> &&</div><div class="line">        Position.X &lt;= Control.Center.X + BoxSize.X * <span class="number">0.5f</span> &&</div><div class="line">        Position.Y &gt;= Control.Center.Y - BoxSize.Y * <span class="number">0.5f</span> &&</div><div class="line">        Position.Y &gt;= Control.Center.Y - BoxSize.Y * <span class="number">0.5f</span>;</div><div class="line">}</div></pre></td></tr></table></figure>

<p>The programmer forgot to make 2 edits in the last line. Firstly, “&gt;=” should be replaced with “&lt;=; secondly, minus should be replaced with plus.</p>
<h4 id="Qt-1">Qt</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">qreal x = ctx-&gt;callData-&gt;args[<span class="number">0</span>].toNumber();</div><div class="line">qreal y = ctx-&gt;callData-&gt;args[<span class="number">1</span>].toNumber();</div><div class="line">qreal w = ctx-&gt;callData-&gt;args[<span class="number">2</span>].toNumber();</div><div class="line">qreal h = ctx-&gt;callData-&gt;args[<span class="number">3</span>].toNumber();</div><div class="line"><span class="keyword">if</span> (!qIsFinite(x) || !qIsFinite(y) ||</div><div class="line">    !qIsFinite(w) || !qIsFinite(w))</div></pre></td></tr></table></figure>

<p>In the very last call of the function qIsFinite, the ‘h’ variable should have been used as an argument.</p>
<h4 id="OpenSSL">OpenSSL</h4>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> (!<span class="built_in">strncmp</span>(vstart, <span class="string">"ASCII"</span>, <span class="number">5</span>))</div><div class="line">    arg-&gt;format = ASN1_GEN_FORMAT_ASCII;</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strncmp</span>(vstart, <span class="string">"UTF8"</span>, <span class="number">4</span>))</div><div class="line">    arg-&gt;format = ASN1_GEN_FORMAT_UTF8;</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strncmp</span>(vstart, <span class="string">"HEX"</span>, <span class="number">3</span>))</div><div class="line">    arg-&gt;format = ASN1_GEN_FORMAT_HEX;</div><div class="line"><span class="keyword">else</span> <span class="keyword">if</span> (!<span class="built_in">strncmp</span>(vstart, <span class="string">"BITLIST"</span>, <span class="number">3</span>))</div><div class="line">    arg-&gt;format = ASN1_GEN_FORMAT_BITLIST;</div></pre></td></tr></table></figure>

<p>The length of the “BITLIST” string is 7, not 3 characters.</p>
<p>As you can see even highly-skilled developers of such projects as Clang or Qt tend to make mistakes of this kind. So please stop copy and paste in your code.</p>
<p>Original Post: <a href="http://www.cplusplus.com/articles/Lz86b7Xj/" target="_blank" rel="external">http://www.cplusplus.com/articles/Lz86b7Xj/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/10/07/Stop-Copy-and-Paste-in-your-code/" data-id="wz4vtck8be74uq3m" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-When-Smart-Pointers-Meet-Forward-Declaration" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/09/17/When-Smart-Pointers-Meet-Forward-Declaration/" class="article-date">
  <time datetime="2014-09-17T08:47:20.000Z" itemprop="datePublished">Sep 17 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/09/17/When-Smart-Pointers-Meet-Forward-Declaration/">When Smart Pointers Meet Forward Declaration</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="What_is_Forward_Declaration">What is Forward Declaration</h3>
<p>Forward Declaration is a technic in C++ which allows you to use the type name without including the header file. It saves time when compiling the code. Usually it’s used when we declare a pointer to the type in class declaration if we don’t want to access its members (at that moment).</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Bar;  <span class="comment">// forward declaration of class Bar</span></div><div class="line"></div><div class="line"><span class="keyword">class</span> Foo</div><div class="line">{</div><div class="line">    <span class="comment">// Something you don't care</span></div><div class="line">	</div><div class="line">    Bar *bar;  <span class="comment">// Pointer to Bar</span></div><div class="line">};</div></pre></td></tr></table></figure>

<p>Alternatively you can use in-place declaration.</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Foo</div><div class="line">{</div><div class="line">    <span class="comment">// Something you don't care</span></div><div class="line">	</div><div class="line">    <span class="keyword">class</span> Bar *bar;  <span class="comment">// Pointer to Bar</span></div><div class="line">};</div></pre></td></tr></table></figure>

<h3 id="Smart_Pointers">Smart Pointers</h3>
<p>C++11 has been widely used nowadays, and one of the exciting features is smart pointers (std::shared_ptr, std::unique_ptr, std::weak_ptr). We merely use raw pointers now, because by using the smart pointers we no longer care about when should we release the objects. So the above class Foo can be envolved.</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Bar;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Foo</div><div class="line">{</div><div class="line">    std::unique_ptr&lt;Bar&gt; bar;</div><div class="line">};</div></pre></td></tr></table></figure>

<h3 id="The_Problem">The Problem</h3>
<p>Nice! We used forward declaration to avoid including the header file, and smart pointer to take care of the memory. Let’s compile the code.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ERROR: <span class="keyword">use</span> <span class="keyword">of</span> incomplete <span class="class"><span class="keyword">type</span> '<span class="title">Bar</span>'.</span></div></pre></td></tr></table></figure>

<p>Wait! What happened? What the hell is incomplete type?</p>
<h3 id="Analysis">Analysis</h3>
<p>In the code above, we forward declared class Bar. Remember the point of forward declaration? We can’t access its members. So when did we potentially used the members of class Bar? Yes, the std::unique_ptr.</p>
<p>The std::unique_ptr takes care of the resource. When the smart pointer goes out of scope, it destroies the instance of class Bar, it calls Bar::~Bar() for us!</p>
<p>Okey, let’s check when the smart pointer goes out of scope. Right! The smart pointer dies when the instance of class Foo dies!</p>
<p>So what is the root of this problem? Can’t we use smart pointers with forward declaration? No! Of course we can combine the power of smart pointer and forward declaration. If you have a good compiler (like Clang bundled with Xcode), you can check the massive error output when compiling the code, and you can find something like this:</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">default_delete can not <span class="built_in">delete</span> incomplete <span class="built_in">type</span></div></pre></td></tr></table></figure>

<p>default_delete. Hmmm… the default destructor?! Yes! C++ compiler generates default destructor for every class if we don’t provide one, and of course it’s not been done by pasting the code after our .cpp file :). Does the destructor know the complete declaration of class Bar? Not in our case.</p>
<h3 id="Solve_the_Problem">Solve the Problem</h3>
<p>Now it’s clear, the default destructor caused the tricky problem. All we need to do is to let the destructor know the declaration of class Bar. How? Well, you can simply include the Bar.h, but we lose the forward declaration. Since eventually we’ll include the header file in Foo.cpp, I’d prefer to implement destructor myself.</p>
<p>Foo.h</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">class</span> Bar;</div><div class="line"></div><div class="line"><span class="keyword">class</span> Foo</div><div class="line">{</div><div class="line">    ~Foo();</div><div class="line">    std::unique_ptr&lt;Bar&gt; bar;</div><div class="line">};</div></pre></td></tr></table></figure>

<p>Foo.cpp</p>
<figure class="highlight C++"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="preprocessor">#<span class="keyword">include</span> "Bar.h"  <span class="comment">// of course we'll use this in Foo.cpp!</span></span></div><div class="line"></div><div class="line">Foo::~Foo()</div><div class="line">{</div><div class="line">    <span class="comment">// Nothing to do</span></div><div class="line">}</div></pre></td></tr></table></figure>

<p>Now let’s compile the code. Woohoo!</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/09/17/When-Smart-Pointers-Meet-Forward-Declaration/" data-id="eeov5qx0r1gnsnya" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/C++/">C++</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-New-To-TDD" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/08/31/New-To-TDD/" class="article-date">
  <time datetime="2014-08-31T09:50:20.000Z" itemprop="datePublished">Aug 31 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/31/New-To-TDD/">New To TDD</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="What_is_TDD">What is TDD</h2>
<p>TDD - Test Driven Development, is a methodology to help building better software. The general idea of TDD is to build software in the RED-&gt;GREEN-&gt;YELLOW cycle.</p>
<h3 id="RED">RED</h3>
<p>In TDD, the test code is written first. Since we havn’t write any business code at this moment, the test cases shall fail - either the code won’t compile or current code can’t meet the test cases’ demand.</p>
<h3 id="GREEN">GREEN</h3>
<p>In this stage, we develop the business code to pass the test cases. We don’t have to gold-plate the code at this stage; we just need the code to pass the tests.</p>
<h3 id="YELLOW">YELLOW</h3>
<p>And now before we jump into new functions, we must refactor the code. Refactoring the code makes the code more clear, and easier for futher development. In this stage, we modify the code and run test cases at the same time to ensure we didn’t break any function.</p>
<h2 id="Why_TDD">Why TDD</h2>
<p>People make mistakes. That’s why we need TDD here, to set a bar to verify whether the code works. If we craft test cases clearly enough, when can ensure that we have completed the software’s requirement if the code is in GREEN stage.</p>
<p>Also, we need a way to ensure that we won’t break existing functions by modifing existing code or adding new code.</p>
<h2 id="TDD_is_not_Almighty">TDD is not Almighty</h2>
<p>TDD is good, but it’s not almighty. There’re things TDD can’t cover, and there’re things TDD breaks. For an example, you can’t really test if a RANDOM functio really generates random numbers. Also, when using TDD, you sometimes have to break the code to make it easier to test.</p>
<p>Any way, when people are not so clear about the requirements, TDD is a good way to help evolving the code. So before a new mighty methodology is developed, why not stick to it?</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/08/31/New-To-TDD/" data-id="0ebegl1rji0plllr" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/TDD/">TDD</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2014/08/28/hello-world/" class="article-date">
  <time datetime="2014-08-28T03:10:17.000Z" itemprop="datePublished">Aug 28 2014</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2014/08/28/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="http://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="http://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="http://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">trobuleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick_Start">Quick Start</h2>
<h3 id="Create_a_new_post">Create a new post</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run_server">Run server</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate_static_files">Generate static files</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy_to_remote_sites">Deploy to remote sites</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>

<p>More info: <a href="http://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2014/08/28/hello-world/" data-id="mf239yrwd7w4jnp3" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
  
</section>
        
          <aside id="sidebar">
  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/C++/">C++</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TDD/">TDD</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/C++/" style="font-size: 20.00px;">C++</a><a href="/tags/C++-Smart-Pointer/" style="font-size: 10.00px;">C++ Smart Pointer</a><a href="/tags/C++,-Smart-Pointer/" style="font-size: 10.00px;">C++, Smart Pointer</a><a href="/tags/C++;-Smart-Pointer/" style="font-size: 10.00px;">C++; Smart Pointer</a><a href="/tags/C++Smart-Pointer/" style="font-size: 10.00px;">C++|Smart Pointer</a><a href="/tags/TDD/" style="font-size: 20.00px;">TDD</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/10">October 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/09">September 2014</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/08">August 2014</a><span class="archive-list-count">2</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2014/10/07/Stop-Copy-and-Paste-in-your-code/">Stop Copy and Paste in your code</a>
          </li>
        
          <li>
            <a href="/2014/09/17/When-Smart-Pointers-Meet-Forward-Declaration/">When Smart Pointers Meet Forward Declaration</a>
          </li>
        
          <li>
            <a href="/2014/08/31/New-To-TDD/">New To TDD</a>
          </li>
        
          <li>
            <a href="/2014/08/28/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2014 wane!<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">

  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>



<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>